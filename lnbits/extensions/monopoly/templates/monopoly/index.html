{% extends "base.html" %} {% from "macros.jinja" import window_vars with context
%} {% block scripts %} {{ window_vars(user) }}
<script type="module" src="/monopoly/static/js/index.js"></script>
<!-- CDNJS :: Sortable (https://cdnjs.com/) -->
<script src="//cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>
<!-- CDNJS :: Vue.Draggable (https://cdnjs.com/) -->
<script src="//cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.20.0/vuedraggable.umd.min.js"></script>
{% endblock %} {% block page %}
<link rel="stylesheet" href="/monopoly/static/css/monopoly.css"/>
<div id="monopoly" class="row q-col-gutter-md">
  <div class="col-12 col-md-7 q-gutter-y-md">

    <q-card>
      <!-- Welcome view -->
      <div style="padding: 1em; font-size: 1.2em;" v-if="!game.created && !game.imported">
        <div class="row">
          <span class="col-8 col-md-8" style="margin-top: 0.5em;">
             Welcome to Bitcoin Monopoly!
          </span>
          <span class="offset-1 col-3 offset-md-1 col-md-3" style="margin-top:0.5em; font-size:1em">
            <q-btn row color="primary" icon="account_balance" style="margin-left: 2em;" @click="createGame()">
              <span style="margin-left:0.25em;">Start</span>
            </q-btn>
          </span>
        </div>
        <div class="row">
          <span class="col-12 col-md-12" style="margin-top: 1.5em; font-size: 0.87em">
                Click the Start button to create a new game and generate your dedicated LNBits player wallet
          </span>
        </div>
      </div>

      <!-- Game funding view -->
      <div style="padding: 1em; font-size: 1.2em;" v-if="game.created && game.showFundingView">
        <div class="row">
          <span class="col-8 col-md-8" style="margin-top: 0.5em;">
             You are {% raw %}{{game.player.name}}{% endraw %}!
          </span>
          <span class="col-2 col-md-2" style="margin-top: 0.5em;">
            <q-btn row color="primary" icon="qr_code_2" size="1em" style="margin-left: 2em;" v-if="game.created"@click="showFundingDialog()">
            </q-btn>
          </span>
          <span v-if="game.bankBalance >= game.minFunding" class="col-2 col-md-2" style="margin-top: 0.5em;">
            <q-btn row color="primary" icon="play_circle" size="1em" v-if="game.created"@click="onGameFunded()"></q-btn>
          </span>
          <span v-else class="col-2 col-md-2" style="margin-top: 0.5em;">
            <q-btn disabled row color="grey" icon="play_circle" size="1em" v-if="game.created"@click=""></q-btn>
          </span>
        </div>
        <div class="row">
          <span class="col-8 col-md-8" style="margin-top: 0.5em;">
             Fund the bank to start playing (minimum {% raw %} {{game.minFunding}} {% endraw %} sats)...
          </span>
        </div>
        <!-- Spinner -->
        <div class="row">
          <div class="offset-5 col-2 offset-md-5 col-md-2" style="margin-top: 2em; margin-bottom: 2em; display: flex; justify-content: center;">
            <q-spinner
              color="primary"
              size="2em"
            />
          </div>
        </div>
      </div>

      <!-- Invite players view -->
      <div style="padding: 1em; font-size: 1.2em;" v-if="game.fundingStatus == 'success' && !game.started">
        <!-- For game creator -->
        <div class="row" v-if="game.created">
          <span v-if="game.playersCount < game.minPlayersCount" class="col-8 col-md-8" style="margin-top: 0.5em;">
            Invite at least {% raw %}{{game.minPlayersCount - game.playersCount}}{% endraw %} more player to start playing
          </span>
          <span v-else-if="game.playersCount >= game.minPlayersCount && game.playersCount < game.maxPlayersCount" class="col-8 col-md-8" style="margin-top: 0.5em;">
            Invite up to {% raw %}{{game.maxPlayersCount - game.playersCount}}{% endraw %} more players or start playing now
          </span>
          <span v-else class="col-8 col-md-8" style="margin-top: 0.5em;">
            Click the play button to start playing now
          </span>
          <span class="col-2 col-md-2" style="margin-top: 0.5em;">
            <q-btn  v-if="game.playersCount >= game.maxPlayersCount" disabled row icon="qr_code_2" size="1em" style="margin-left: 2em;" @click="showInviteQR"></q-btn>
            <q-btn  v-else-if="game.lnurlVoucherId" row color="primary" icon="qr_code_2" size="1em" style="margin-left: 2em;" @click="showInviteQR"></q-btn>
          </span>
          <span class="col-2 col-md-2" style="margin-top: 0.5em;">
            <q-btn v-if="game.playersCount >= game.minPlayersCount" row color="primary" icon="play_circle" size="1em" @click="startGame()"></q-btn>
            <q-btn v-else disabled row icon="play_circle" size="1em" @click="startGame()"></q-btn>
          </span>
        </div>
        <!-- For invited players -->
        <div class="row" v-else-if="game.imported">
          <span class="col-8 col-md-8" style="margin-top: 0.5em;">
             You are {% raw %}{{game.player.name}}{% endraw %}!
          </span>
          <span class="col-6 col-md-8" style="margin-top: 0.5em;">
            Waiting for game creator to start the game...
          </span>
        </div>
        <!-- Spinner -->
        <div class="row">
          <div class="offset-5 col-2 offset-md-5 col-md-2" style="margin-top: 2em; margin-bottom: 2em; display: flex; justify-content: center;">
            <q-spinner
              color="primary"
              size="2em"
            />
          </div>
        </div>
      </div>

      <!-- Game view -->
      <div class="row" style="padding: 1em; font-size: 1.2em;" v-if="game.started">
          <span class="col-7 col-md-8" style="padding: 0.5em; font-size: 1.2em;">
            Game on!
          </span>
          <span class="col-2 offset-md-1 col-md-1" style="padding: 0.5em;">
            <q-btn row color="primary" icon="qr_code_2" size="1em" @click="showPlayerInvoiceDialog"></q-btn>
          </span>
          <span class="col-2 col-md-1" style="padding: 0.5em; margin-left: 1em">
            <q-btn row color="primary" icon="photo_camera" size="1em" @click="showCamera"></q-btn>
          </span>
      </div>
    </q-card>

    <q-card class="row col-12 col-md-12" v-if="game.started">
      <span v-if="!game.showExplanationText" class="offset-10 col-1 offset-md-11 col-md-1" style="padding: 0.5em;">
        <q-btn row icon="expand_more" size="0.5em" @click="showExplanationText()"></q-btn>
      </span>
      <span v-if="game.showExplanationText" class="offset-10 col-1 offset-md-11 col-md-1" style="padding: 0.5em;">
        <q-btn row icon="expand_less" size="0.5em" @click="hideExplanationText()"></q-btn>
      </span>
      <div class="row" v-if="game.showExplanationText" style="padding: 0.5em;">
        <span class="col-12 col-md-12" style="padding: 0.5em; font-size: 1em;">
          Play using the Bitcoin Monopoly physical board, rolling dices
          and drawing cards as you would do playing classic Monopoly. Use the
          LNBits Bitcoin Monopoly extension to buy and upgrade properties, and
          every time you need to send and receive payments.
        </span>
        <span class="col-12 col-md-12" style="padding: 0.5em; font-size: 1em;">
          All payments are made with sats via the Lightning network. Use the
          Camera button to scan QR codes (properties, cards, invoices, payment
          links and vouchers). Use the Invoice button to generate custom
          invoices and request payments from other players.
        </span>
      </div>

      <div class="col-12 col-md-12" style="padding: 0.5em; font-size: 1.75em;">
        Your properties
      </div>

      <div class="row" v-if="!game.propertiesCount[game.player.id] || game.propertiesCount[game.player.id] == 0" style="padding: 0.5em;">
        <span class="col-12 col-md-12" style="padding: 0.5em; font-size: 1em;">
          You don’t own any properties yet. Scan a property’s QR code using the
          Camera button above to buy your first property.
        </span>
      </div>

      <div v-else class="row col-12 col-md-12" style="padding: 1em;">
        <div
          v-if="game.properties[game.player.id] && game.properties[game.player.id][colorGroup] && game.properties[game.player.id][colorGroup].length"
          class="row col-4 col-md-4"
          style="margin-bottom: 3em;"
          v-for="colorGroup in Object.keys(game.properties[game.player.id])"
        >

            <q-card
              v-ripple
              class="no-shadow row col-9 col-md-9"
              style="margin-left: 1.5em;"
            >
                <draggable
                  class="cards-stack"
                  :group="colorGroup"
                  v-model="game.properties[game.player.id][colorGroup]"
                  v-bind="dragOptions"
                  :move="onMove"
                  @start="onStartDrag()"
                  @end="onDragged($event, colorGroup)"
                  tag="div"
                  :style="reactiveStyle.cardsStack"
                >
                  <li
                    v-for="card in game.properties[game.player.id][colorGroup]"
                    :id="card.id"
                    class="my-box cursor-pointer q-hoverable row col-12 col-md-12"
                    :style="reactiveStyle.card(card)"
                    @click="showPropertyDetails(card)"
                  >
                    <img
                      class="col-12 col-md-12 image-hover-highlight"
                      :src=card.imgPath
                      alt="card"
                    >
                  </li>
                </draggable>
            </q-card>

        </div>
        </div>
    </q-card>

  </div>

  <!-- Right panel to display general game data -->
  <div class="col-12 col-md-5 q-gutter-y-md" v-if="game.created || game.imported">
    <q-card>
      <q-card-section>

        <!-- Bank balance -->
        <div style="padding: 1em; font-size: 1.2em;">
          Bank balance: {% raw %} {{game.bankBalance}} {% endraw %} sats
        </div>

        <!-- Players table -->
        <div class="q-pa-md">
          <q-table
            title="Players"
            dense
            :data="game.playersData.rows"
            :columns="game.playersData.columns"
            row-key="name"
            :rows-per-page-options="[game.maxPlayersCount]"
            hide-bottom
          />
        </div>

      </q-card-section>
    </q-card>
  </div>

  <!-- Camera popup -->
  <q-dialog v-model="camera.show">
    <q-card class="q-pa-lg q-pt-xl">
      <div class="text-center q-mb-lg">
        <qrcode-stream
          @decode="decodeQR"
          class="rounded-borders"
        ></qrcode-stream>
      </div>
      <div class="row q-mt-lg">
        <q-btn @click="closeCamera" flat color="grey" class="q-ml-auto">Cancel</q-btn>
      </div>
    </q-card>
  </q-dialog>

  <!-- QR code dialog popup -->
  <q-dialog
    v-model="qrCodeDialog.show"
    position="top"
  >
    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card text-center">
      <a>
        <q-responsive :ratio="1" class="q-mx-xs">
          <qrcode
            :value="qrCodeDialog.data"
            :options="{width: 400}"
            class="rounded-borders"
          ></qrcode>
        </q-responsive>
      </a>
      <br />
      <div class="row q-mt-lg" style="margin-left: 350px;">
        <q-btn
          outline
          color="grey"
          @click="closeBankExportQR"
        >Close</q-btn>
      </div>
    </q-card>
  </q-dialog>

  <!-- Game funding dialog popup -->
  <q-dialog v-model="game.showFundingDialog" @hide="closeReceiveDialog">
    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card">
      <q-tabs  v-model="fundingTab"
               dense
               class="text-grey"
               active-color="primary"
               indicator-color="primary"
               align="justify"
               narrow-indicator
      >
        <q-tab name="paylnurl" label="Pay LNURL"></q-tab>
        <q-tab name="invoice" label="Invoice"></q-tab>
      </q-tabs>
      <q-tab-panels v-model="fundingTab" animated style="margin-top: 1em;">
        <q-tab-panel name="paylnurl" class="q-card--dark">
          <div class="text-center q-mb-lg">Fund the bank by sending sats to this payment link</div>
          <div class="text-center q-mb-lg">
            <a :href="game.lnurlPayLink">
              <q-responsive :ratio="1" class="q-mx-xl">
                <qrcode
                  :value="game.lnurlPayLink"
                  :options="{width: 340}"
                  class="rounded-borders"
                ></qrcode>
              </q-responsive>
            </a>
          </div>
          <div class="row q-mt-lg">
            <q-btn outline color="grey" @click="copyText(game.lnurlPayLink)"
            >Copy LNURL</q-btn>
            <q-btn v-close-popup flat color="grey" class="q-ml-auto"
            >Close</q-btn>
          </div>
        </q-tab-panel>
        <q-tab-panel name="invoice" class="q-card--dark">
          <div v-if="game.fundingInvoice.paymentReq" class="text-center q-mb-lg">
            Fund the bank by paying this invoice ({% raw %}{{game.fundingInvoice.data.amount}}{% endraw %} sats)
          </div>
          <div v-if="game.fundingInvoice.paymentReq" class="text-center q-mb-lg">
            <a :href="'lightning:' + game.fundingInvoice.paymentReq">
              <q-responsive :ratio="1" class="q-mx-xl">
                <qrcode
                  :value="game.fundingInvoice.paymentReq"
                  :options="{width: 340}"
                  class="rounded-borders"
                ></qrcode>
              </q-responsive>
            </a>
          </div>
          <div class="row">
            <div class="col-8 col-md-8">
              <q-form @submit="createFundingInvoice()" class="q-gutter-md col-8 col-md-8">
                <q-input
                  filled
                  dense
                  v-model.trim="game.fundingInvoiceAmount"
                  label="New invoice amount (sats)"
                  placeholder=""
                ></q-input>
              </q-form>
            </div>
            <div class="q-gutter-md offset-1 col-3 offset-md-1 col-md-3">
              <q-btn @click="createFundingInvoice()" flat color="grey" class="q-ml-auto">Generate</q-btn>
            </div>
          </div>
          <div class="row q-mt-lg">
            <q-btn v-if="game.fundingInvoice.paymentReq" outline color="grey" @click="copyText(game.payInvoiceCommand + game.fundingInvoice.paymentReq)">Copy invoice</q-btn>
            <q-btn v-else disabled outline color="grey" @click="">Copy invoice</q-btn>
            <q-btn v-close-popup flat color="grey" class="q-ml-auto">Close</q-btn>
          </div>
        </q-tab-panel>
      </q-tab-panels>
    </q-card>
  </q-dialog>

  <!-- Game invite link popup -->
  <q-dialog v-model="game.showInviteQR" @hide="closeInviteQR">
    <q-card
      v-if="!game.inviteLink"
      class="q-pa-lg q-pt-xl lnbits__dialog-card"
    ></q-card>
    <q-card v-else class="q-pa-lg q-pt-xl lnbits__dialog-card">
      <div class="text-center q-mb-lg">
        <a :href="game.inviteLink">
          <q-responsive :ratio="1" class="q-mx-xl">
            <qrcode
              :value="game.inviteLink"
              :options="{width: 340}"
              class="rounded-borders"
            ></qrcode>
          </q-responsive>
        </a>
      </div>
      <div class="row q-mt-lg">
        <q-btn outline color="grey" @click="copyText(game.inviteLink)"
        >Copy invite link</q-btn>
        <q-btn v-close-popup flat color="grey" class="q-ml-auto"
        >Close</q-btn>
      </div>
    </q-card>
  </q-dialog>

  <q-dialog v-model="game.showPlayerInvoiceDialog" @hide="closePlayerInvoiceDialog">

    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card q-card--dark" style="padding: 1em;">

    <div v-if="game.playerInvoice.paymentReq" class="text-center q-mb-lg">
      Request funds by showing this invoice ({% raw %}{{game.playerInvoice.data.amount}}{% endraw %} sats)
    </div>
    <div v-if="game.playerInvoice.paymentReq" class="text-center q-mb-lg">
      <a :href="'lightning:' + game.playerInvoice.paymentReq">
        <q-responsive :ratio="1" class="q-mx-xl">
          <qrcode
            :value="game.playerInvoice.paymentReq"
            :options="{width: 340}"
            class="rounded-borders"
          ></qrcode>
        </q-responsive>
      </a>
    </div>
    <div class="row">
      <div class="col-8 col-md-8">
        <q-form @submit="createPlayerInvoice()" class="q-gutter-md col-8 col-md-8">
          <q-input
            filled
            dense
            v-model.trim="game.playerInvoiceAmount"
            label="New invoice amount (sats)"
            placeholder=""
          ></q-input>
        </q-form>
      </div>
      <div class="q-gutter-md offset-1 col-3 offset-md-1 col-md-3">
        <q-btn @click="createPlayerInvoice()" flat color="grey" class="q-ml-auto">Generate</q-btn>
      </div>
    </div>
    <div class="row q-mt-lg">
      <q-btn v-if="game.playerInvoice.paymentReq" outline color="grey" @click="copyText(game.playerInvoice.paymentReq)">Copy invoice</q-btn>
      <q-btn v-else disabled outline color="grey" @click="">Copy invoice</q-btn>
      <q-btn v-close-popup flat color="grey" class="q-ml-auto">Close</q-btn>
    </div>
    </q-card>
  </q-dialog>


  <q-dialog v-model="game.showPropertyDialog" @hide="game.showPropertyDialog = false">

    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card q-card--dark" style="padding: 1em;">

      <div v-if="game.propertyToShow">

        <q-card class="q-card--dark row" style="padding: 1em;">

        <div class="col-7 col-md-7">
          <img
            class="image-hover-highlight"
            :src=game.propertyToShow.imgPath
            alt="property"
            :style="reactiveStyle.propertyImage"
          >
        </div>

        <div class="col-5 col-md-5">
          <div
            v-if="game.propertyToShow.owner && game.propertyToShow.owner == game.player.id"
            :style="reactiveStyle.propertyOwnershipLabel"
          >
            You own this property
          </div>
          <div
            v-else-if="game.propertyToShow.owner && game.propertyToShow.owner != game.player.id"
            :style="reactiveStyle.propertyOwnershipLabel"
          >
            {% raw %}{{game.propertyToShow.owner}}{% endraw %} owns this property
          </div>
          <div
            v-else
            :style="reactiveStyle.propertyOwnershipLabel"
          >
            This property is for sale
          </div>

          <div
            :style="reactiveStyle.propertyMiningCapacityLabel"
          >
            Mining capacity: {% raw %}{{game.propertyToShow.miningCapacity}}{% endraw %} kW
          </div>

          <div
            :style="reactiveStyle.propertyMiningIncomeLabel"
          >
            Cumulated mining income: {% raw %}{{game.propertyToShow.miningIncome}}{% endraw %} sats
          </div>

          <div
            v-if="game.propertyToShow.owner && game.propertyToShow.owner == game.player.id"
            class="row"
            :style="reactiveStyle.propertyButtons.cardButtonsGroup"
          >
            <div :style="reactiveStyle.propertyButtons.invoiceButton">
              <q-btn @click="createNetworkFeeInvoice(game.propertyToShow)" flat color="grey" class="q-ml-auto">
                Invoice fee
              </q-btn>
            </div>
            <div :style="reactiveStyle.propertyButtons.upgradeButton">
              <q-btn @click="showCamera" flat color="grey" class="q-ml-auto">
                Upgrade miners
              </q-btn>
            </div>

          </div>

          <div
            v-else-if="game.propertyToShow.owner && game.propertyToShow.owner != game.player.id"
            class="row"
            :style="reactiveStyle.propertyButtons.cardButtonsGroup"
          >
            <div :style="reactiveStyle.propertyButtons.offerButton">
              <q-btn @click="createOfferVoucher(game.propertyToShow)" flat color="grey" class="q-ml-auto">
                Make offer
              </q-btn>
            </div>
          </div>

          <div
            v-else
            class="row"
            :style="reactiveStyle.propertyButtons.cardButtonsGroup"
          >
            <div :style="reactiveStyle.propertyButtons.buyButton">
              <q-btn @click="showCamera" flat color="grey" class="q-ml-auto">
                Buy property
              </q-btn>
            </div>
          </div>

        </div>

        </q-card>
      </div>

    <!--
      <div
        v-if="game.propertyToShow.owner && game.propertyToShow.owner == game.player.id"
         class="row"
         :style="reactiveStyle.propertyButtons.div"
      >
        <div :style="reactiveStyle.propertyButtons.invoiceButton">
          <q-btn @click="createNetworkFeeInvoice(game.propertyToShow)" flat color="grey" class="q-ml-auto">
            Invoice network fee
          </q-btn>
        </div>
        <div :style="reactiveStyle.propertyButtons.upgradeButton">
          <q-btn @click="showCamera" flat color="grey" class="q-ml-auto">
            Upgrade mining capacity
          </q-btn>
        </div>
      </div>
    -->
      <div
        v-if="game.propertyToShow.owner && game.propertyToShow.owner == game.player.id"
        class="row"
        :style="reactiveStyle.propertyButtons.bottomButtonsGroup"
      >
        <div :style="reactiveStyle.propertyButtons.sellButton">
          <q-btn @click="openSaleInvoiceDialog(game.propertyToShow)" flat color="grey" class="q-ml-auto">
            Sell property
          </q-btn>
        </div>
      </div>

    <!--
      <div
        v-else-if="game.propertyToShow.owner && game.propertyToShow.owner != game.player.id"
        class="row"
        :style="reactiveStyle.propertyButtons.div"
      >
        <div :style="reactiveStyle.propertyButtons.offerButton">
          <q-btn @click="createOfferVoucher(game.propertyToShow)" flat color="grey" class="q-ml-auto">
            Make offer
          </q-btn>
        </div>
      </div>

      <div
        v-else class="row"
        :style="reactiveStyle.propertyButtons.div"
      >
        <div
          class="col-12 col-md-12"
          :style="reactiveStyle.propertyButtons.buyButton"
        >
          <q-btn @click="showCamera" flat color="grey" class="q-ml-auto">
            Buy property
          </q-btn>
        </div>
      </div>
    -->

      <div
        v-if="game.created"
        class="row"
        :style="reactiveStyle.propertyButtonsForGameCreator.div"
      >
        <div
          v-if="!game.propertyToShow.owner"
          class="col-12 col-md-12"
          :style="reactiveStyle.propertyButtonsForGameCreator.invoicePurchaseButton"
        >
          <q-btn @click="createPurchaseInvoice(game.propertyToShow)" flat color="grey" class="q-ml-auto">
            Invoice property purchase
          </q-btn>
        </div>
        <div
          v-else
          class="col-12 col-md-12"
          :style="reactiveStyle.propertyButtonsForGameCreator.invoiceUpgradeButton"
        >
          <q-btn @click="createUpgradeInvoice(game.propertyToShow)" flat color="grey" class="q-ml-auto">
            Invoice mining capacity upgrade
          </q-btn>
        </div>
      </div>

      <div class="row">
        <q-btn
          v-close-popup flat color="grey"
          class="q-ml-auto"
          @click="closePropertyDialog()"
          :style="reactiveStyle.propertyCloseButton"
        >
          Close
        </q-btn>
      </div>

    </q-card>
  </q-dialog>

  <q-dialog v-model="game.showPropertyInvoiceDialog" @hide="game.showPropertyInvoiceDialog = false">

    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card q-card--dark" style="padding: 1em;">


<!--
      <div v-if="game.playerInvoice.paymentReq">
        <div class="text-center q-mb-lg">
          Request payment by showing this invoice ({% raw %}{{game.playerInvoice.data.amount}}{% endraw %} sats)
        </div>

        <div class="text-center q-mb-lg">
          <a :href="'lightning:' + game.playerInvoice.paymentReq">
            <q-responsive :ratio="1" class="q-mx-xl">
              <qrcode
                :value="game.playerInvoice.paymentReq"
                :options="{width: 340}"
                class="rounded-borders"
              ></qrcode>
            </q-responsive>
          </a>
        </div>
      </div>
-->

      <div v-if="game.purchaseInvoiceCreated">
        <div class="text-center q-mb-lg">
          Scan this QR code and pay the attached invoice ({% raw %}{{game.fundingInvoice.data.amount}}{% endraw %} sats) in order to purchase this property
        </div>

        <div class="text-center q-mb-lg">
          <q-responsive :ratio="1" class="q-mx-xl">
            <qrcode
              :value="game.propertyPurchaseData"
              :options="{width: 340}"
              class="rounded-borders"
            ></qrcode>
          </q-responsive>
        </div>
      </div>

      <div v-if="game.showNetworkFeeInvoice">
        <div class="text-center q-mb-lg">
          Scan this QR code and pay the attached invoice ({% raw %}{{game.playerInvoice.data.amount}}{% endraw %} sats) in order to pay network fees
        </div>

        <div class="text-center q-mb-lg">
          <q-responsive :ratio="1" class="q-mx-xl">
            <qrcode
              :value="game.networkFeeInvoiceData"
              :options="{width: 340}"
              class="rounded-borders"
            ></qrcode>
          </q-responsive>
        </div>
      </div>

      <div v-if="game.upgradeInvoiceCreated">
        <div class="text-center q-mb-lg">
          Scan this QR code and pay the attached invoice ({% raw %}{{game.fundingInvoice.data.amount}}{% endraw %} sats) in order to upgrade property's mining capacity
        </div>

        <div class="text-center q-mb-lg">
            <q-responsive :ratio="1" class="q-mx-xl">
              <qrcode
                :value="game.propertyUpgradeData"
                :options="{width: 340}"
                class="rounded-borders"
              ></qrcode>
            </q-responsive>
        </div>
      </div>

      <div v-if="game.playerVoucher">
        <div class="text-center q-mb-lg">
          Offer to buy this property by showing this voucher ({% raw %}{{game.playerVoucherAmount}}{% endraw %} sats)
        </div>

        <div class="text-center q-mb-lg">
          <a :href="game.playerVoucher">
            <q-responsive :ratio="1" class="q-mx-xl">
              <qrcode
                :value="game.playerVoucher"
                :options="{width: 340}"
                class="rounded-borders"
              ></qrcode>
            </q-responsive>
          </a>
        </div>
      </div>

      <div v-if="game.showSaleInvoiceDialog">

        <div v-if="game.saleInvoiceCreated">
          <div class="text-center q-mb-lg">
            Scan this QR code and pay the attached invoice ({% raw %}{{game.playerInvoice.data.amount}}{% endraw %} sats) in order to purchase this property
          </div>

          <div class="text-center q-mb-lg">
            <q-responsive :ratio="1" class="q-mx-xl">
              <qrcode
                :value="game.propertySaleData"
                :options="{width: 340}"
                class="rounded-borders"
              ></qrcode>
            </q-responsive>
          </div>
        </div>

        <div class="row">
          <div class="col-8 col-md-8">
            <q-form @submit="createSaleInvoice(game.propertyToShow, game.playerInvoiceAmount)" class="q-gutter-md col-8 col-md-8">
              <q-input
                filled
                dense
                v-model.trim="game.playerInvoiceAmount"
                label="New invoice amount (sats)"
                placeholder=""
              ></q-input>
            </q-form>
          </div>
          <div class="q-gutter-md offset-1 col-3 offset-md-1 col-md-3">
            <q-btn @click="createSaleInvoice(game.propertyToShow, game.playerInvoiceAmount)" flat color="grey" class="q-ml-auto">Generate</q-btn>
          </div>
        </div>
      </div>

      <div v-if="game.offerVoucher" class="row">
        <div class="col-8 col-md-8">
          <q-form @submit="createPlayerWithdrawLNURL()" class="q-gutter-md col-8 col-md-8">
            <q-input
              filled
              dense
              v-model.trim="game.playerVoucherAmount"
              label="New offer amount (sats)"
              placeholder=""
            ></q-input>
          </q-form>
        </div>
        <div class="q-gutter-md offset-1 col-3 offset-md-1 col-md-3">
          <q-btn @click="createPlayerWithdrawLNURL()" flat color="grey" class="q-ml-auto">Generate</q-btn>
        </div>
      </div>

      <div class="row q-mt-lg">
        <q-btn v-if="game.playerInvoice.paymentReq" outline color="grey" @click="copyText(game.playerInvoice.paymentReq)">Copy invoice</q-btn>
        <q-btn v-else-if="game.fundingInvoice.paymentReq" outline color="grey" @click="copyText(game.fundingInvoice.paymentReq)">Copy invoice</q-btn>
        <q-btn v-else disabled outline color="grey" @click="">Copy invoice</q-btn>
        <q-btn v-close-popup flat color="grey" class="q-ml-auto" @click="closePropertyInvoiceDialog()">Close</q-btn>
      </div>

    </q-card>
  </q-dialog>

  <q-dialog v-model="game.showPropertyPurchaseDialog" @hide="game.showPropertyPurchaseDialog = false">

      <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card q-card--dark" style="padding: 1em;">

        <div v-if="game.propertyPurchase.invoice">
          <q-card class="q-card--dark row" style="padding: 1em;">

            <div class="col-7 col-md-7">
              <img
                class="image-hover-highlight"
                :src=game.propertyPurchase.property.imgPath
                alt="property"
                :style="reactiveStyle.propertyImage"
              >
            </div>

            <div class="col-5 col-md-5">
              <div
                :style="reactiveStyle.propertyOwnershipLabel"
              >
                Buy this property for {% raw %}{{game.propertyPurchase.invoiceAmount}}{% endraw %} sats
              </div>

              <div
                class="row"
                :style="reactiveStyle.propertyButtons.cardButtonsGroup"
              >
                <div :style="reactiveStyle.propertyButtons.invoiceButton">
                  <q-btn @click="purchaseProperty()" flat color="grey" class="q-ml-auto">
                    Pay invoice
                  </q-btn>
                </div>
              </div>

            </div>

          </q-card>
        </div>

        <div class="row q-mt-lg">
          <q-btn v-close-popup flat color="grey" class="q-ml-auto" @click="closePropertyDialog()">Close</q-btn>
        </div>
      </q-card>
  </q-dialog>

  <q-dialog v-model="game.showPropertyUpgradeDialog" @hide="game.showPropertyUpgradeDialog = false">

    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card q-card--dark" style="padding: 1em;">

      <div v-if="game.propertyUpgrade.invoice">
        <q-card class="q-card--dark row" style="padding: 1em;">

          <div class="col-7 col-md-7">
            <img
              class="image-hover-highlight"
              :src=game.propertyUpgrade.property.imgPath
              alt="property"
              :style="reactiveStyle.propertyImage"
            >
          </div>

          <div class="col-5 col-md-5">
            <div
              :style="reactiveStyle.propertyOwnershipLabel"
            >
              Upgrade this property's mining capacity for {% raw %}{{game.propertyUpgrade.invoiceAmount}}{% endraw %} sats
            </div>

            <div
              class="row"
              :style="reactiveStyle.propertyButtons.cardButtonsGroup"
            >
              <div :style="reactiveStyle.propertyButtons.invoiceButton">
                <q-btn @click="upgradeProperty()" flat color="grey" class="q-ml-auto">
                  Pay invoice
                </q-btn>
              </div>
            </div>

          </div>

        </q-card>
      </div>

      <div class="row q-mt-lg">
        <q-btn v-close-popup flat color="grey" class="q-ml-auto" @click="closePropertyDialog()">Close</q-btn>
      </div>
    </q-card>
  </q-dialog>

  <q-dialog v-model="game.showNetworkFeePaymentDialog" @hide="game.showNetworkFeePaymentDialog = false">

    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card q-card--dark" style="padding: 1em;">

      <div v-if="game.networkFeeInvoice.invoice">
        <q-card class="q-card--dark row" style="padding: 1em;">

          <div class="col-7 col-md-7">
            <img
              class="image-hover-highlight"
              :src=game.networkFeeInvoice.property.imgPath
              alt="property"
              :style="reactiveStyle.propertyImage"
            >
          </div>

          <div class="col-5 col-md-5">
            <div
              :style="reactiveStyle.propertyOwnershipLabel"
            >
              Pay {% raw %}{{game.networkFeeInvoice.invoiceAmount}}{% endraw %} sats network fee
            </div>

            <div
              class="row"
              :style="reactiveStyle.propertyButtons.cardButtonsGroup"
            >
              <div :style="reactiveStyle.propertyButtons.invoiceButton">
                <q-btn @click="payNetworkFee()" flat color="grey" class="q-ml-auto">
                  Pay invoice
                </q-btn>
              </div>
            </div>

          </div>

        </q-card>
      </div>

      <div class="row q-mt-lg">
        <q-btn v-close-popup flat color="grey" class="q-ml-auto" @click="closeNetworkFeePaymentDialog()">Close</q-btn>
      </div>
    </q-card>
  </q-dialog>


</div>
{% endblock %}
